---
import { getCollection, render, type CollectionEntry } from 'astro:content'
import MagicLink from '@/components/magic-link.astro'
import MermaidIsland from '@/components/mermaid-island.astro'
import ProseLayout from '@/components/prose-layout.astro'
import RubyAnnotation from '@/components/ruby-annotation.astro'
import Toc from '@/components/toc.astro'
import BaseLayout from '@/layouts/base-layout.astro'

export async function getStaticPaths() {
  const posts = await getCollection('posts')
  return posts.map((post: CollectionEntry<'posts'>) => ({
    params: {
      slug: post.id,
    },
    props: {
      post,
    },
  }))
}

const { post } = Astro.props as {
  post: CollectionEntry<'posts'>
}
const { Content, headings } = await render(post)
const pageTitle = post.data.title || `${post.id} - octohash`
---

<BaseLayout title={pageTitle}>
  <ProseLayout frontmatter={post.data} backPath="/posts">
    <Toc headings={headings} />
    <Content components={{ Mermaid: MermaidIsland, MagicLink, RubyAnnotation }} />
  </ProseLayout>
</BaseLayout>
